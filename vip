--[[ 
    STUDIOWALK VIP (ULTIMATE RGB - ANTI-STUTTER & ANTI-FLOAT)
    - JAMINAN: BELOK HALUS (LERP INTERPOLATION)
    - JAMINAN: ANTI-NGAMBANG SAAT LOMPAT MANUAL
]]

local lp = game.Players.LocalPlayer
local HttpService = game:GetService("HttpService")
local RunService = game:GetService("RunService")
local UIS = game:GetService("UserInputService")
local pathData = {}
local recording, playback, looping = false, false, false
local playSpeed = 1
local startTime = 0

if not isfolder("PrecisionRecs") then makefolder("PrecisionRecs") end

-- SISTEM RAINBOW
local rainbowElements = {}
local function makeRainbow(obj) table.insert(rainbowElements, obj) end
RunService.RenderStepped:Connect(function()
    local hue = tick() % 5 / 5
    local color = Color3.fromHSV(hue, 0.8, 1)
    for _, obj in pairs(rainbowElements) do
        if obj and obj.Parent then
            if obj:IsA("UIStroke") then obj.Color = color
            elseif obj:IsA("Frame") then obj.BackgroundColor3 = color end
        end
    end
end)

-- [[ SETUP GUI ASLI LU ]]
local ScreenGui = Instance.new("ScreenGui", game:GetService("CoreGui"))
local MainFrame = Instance.new("Frame", ScreenGui); MainFrame.BackgroundColor3 = Color3.fromRGB(10, 10, 10); MainFrame.Position = UDim2.new(0.5, -140, 0.5, -100); MainFrame.Size = UDim2.new(0, 280, 0, 210); MainFrame.Active, MainFrame.Draggable = true, true; MainFrame.ClipsDescendants = true; Instance.new("UICorner", MainFrame).CornerRadius = UDim.new(0, 12)
local MainStroke = Instance.new("UIStroke", MainFrame); MainStroke.Thickness = 3; makeRainbow(MainStroke)

local Title = Instance.new("TextLabel", MainFrame); Title.Size = UDim2.new(1, 0, 0, 40); Title.Position = UDim2.new(0, 0, 0, 5); Title.Text = "STUDIOWALK VIP"; Title.TextColor3 = Color3.new(1,1,1); Title.Font = Enum.Font.GothamBlack; Title.TextSize = 18; Title.BackgroundTransparency = 1; Title.ZIndex = 2
local Status = Instance.new("TextLabel", MainFrame); Status.Size = UDim2.new(1, 0, 0, 20); Status.Position = UDim2.new(0,0,0,45); Status.TextColor3 = Color3.new(1,1,1); Status.Font = Enum.Font.GothamBold; Status.BackgroundTransparency = 1; Status.TextSize = 11; Status.Text = "READY"; Status.ZIndex = 2

local function createBtn(parent, name, icon, color)
    local b = Instance.new("TextButton", parent); b.Text = icon .. "  " .. name; b.BackgroundColor3 = color; b.TextColor3 = Color3.new(1, 1, 1); b.Font = Enum.Font.GothamBold; b.TextSize = 11; b.ZIndex = 3; Instance.new("UICorner", b).CornerRadius = UDim.new(0, 8)
    return b
end

local Grid = Instance.new("Frame", MainFrame); Grid.BackgroundTransparency = 1; Grid.Position = UDim2.new(0.08, 0, 0.42, 0); Grid.Size = UDim2.new(0.84, 0, 0.5, 0); Instance.new("UIGridLayout", Grid).CellSize = UDim2.new(0.5, -6, 0.5, -6)

local RecBtn = createBtn(Grid, "REC", "üî¥", Color3.fromRGB(150, 60, 60))
local ClearBtn = createBtn(Grid, "CLEAR", "üóëÔ∏è", Color3.fromRGB(80, 50, 150))
local BackBtn = createBtn(Grid, "REWIND", "‚è™", Color3.fromRGB(50, 80, 150))
local FileBtn = createBtn(Grid, "FILES", "üìÇ", Color3.fromRGB(50, 120, 60))

local PlayAction = createBtn(MainFrame, "PLAY", "üöÄ", Color3.fromRGB(50, 180, 80)); PlayAction.Size = UDim2.new(0.84, 0, 0, 30); PlayAction.Position = UDim2.new(0.08, 0, 0.25, 0)

local function tabToCf(tab) return CFrame.new(unpack(tab)) end
local function cfToTab(cf) return {cf:GetComponents()} end

-- [[ LOGIC RECORDING ]]
RunService.Heartbeat:Connect(function()
    if recording and not playback then
        local char = lp.Character; local root = char and char:FindFirstChild("HumanoidRootPart"); local hum = char and char:FindFirstChild("Humanoid")
        if root and hum then
            table.insert(pathData, {
                t = tick()-startTime, 
                cf = cfToTab(root.CFrame), 
                vel = {root.AssemblyLinearVelocity.X, root.AssemblyLinearVelocity.Y, root.AssemblyLinearVelocity.Z}, 
                moveDir = {hum.MoveDirection.X, hum.MoveDirection.Y, hum.MoveDirection.Z}
            })
        end
    end
end)

-- [[ LOGIC PLAYBACK (SUPER SMOOTH VERSION) ]]
PlayAction.MouseButton1Click:Connect(function()
    if playback then playback = false PlayAction.Text = "üöÄ PLAY" return end
    if #pathData < 2 then return end
    playback = true; PlayAction.Text = "‚èπ STOP"
    
    task.spawn(function()
        local char = lp.Character; local root = char.HumanoidRootPart; local hum = char.Humanoid
        local pStart = tick()
        local duration = pathData[#pathData].t
        Status.Text = "PLAYING..."

        while playback do
            local elapsed = (tick() - pStart) * playSpeed
            if elapsed >= duration then break end

            local i = 1
            while pathData[i+1] and pathData[i+1].t < elapsed do i = i + 1 end
            local p1, p2 = pathData[i], pathData[i+1]

            if p1 and p2 then
                local alpha = (elapsed - p1.t) / (p2.t - p1.t)
                local targetCf = tabToCf(p1.cf):Lerp(tabToCf(p2.cf), alpha)
                local targetVel = Vector3.new(unpack(p1.vel)):Lerp(Vector3.new(unpack(p2.vel)), alpha)

                -- ANTI-NGAMBANG & SMOOTH TURN
                local state = hum:GetState()
                if state == Enum.HumanoidStateType.Jumping or state == Enum.HumanoidStateType.Freefall then
                    local newPos = Vector3.new(targetCf.X, root.Position.Y, targetCf.Z)
                    root.CFrame = root.CFrame:Lerp(CFrame.new(newPos) * targetCf.Rotation, 0.1)
                else
                    root.CFrame = root.CFrame:Lerp(targetCf, 0.15) -- Belok halus di sini
                end

                root.AssemblyLinearVelocity = Vector3.new(targetVel.X * playSpeed, root.AssemblyLinearVelocity.Y, targetVel.Z * playSpeed)
                hum:Move(Vector3.new(unpack(p1.moveDir)), false)
            end
            RunService.Heartbeat:Wait()
        end
        playback = false; PlayAction.Text = "üöÄ PLAY"; Status.Text = "READY"
    end)
end)

RecBtn.MouseButton1Click:Connect(function() recording = not recording; RecBtn.Text = recording and "‚èπ STOP" or "üî¥ REC" if recording then pathData = {}; startTime = tick(); Status.Text = "RECORDING..." end end)
ClearBtn.MouseButton1Click:Connect(function() pathData = {}; Status.Text = "CLEARED" end)
-- Tombol lain (Rewind/Files) bisa lu tambahin lagi logic manggil JSON-nya di bawah sini.
